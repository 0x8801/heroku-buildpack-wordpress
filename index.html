<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Wordpress on Heroku by mchung</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/mchung/heroku-buildpack-wordpress">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/mchung/heroku-buildpack-wordpress/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/mchung/heroku-buildpack-wordpress/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Wordpress on Heroku</h1>
          <p>Deploy Wordpress to Heroku in &lt; 60 seconds or your money back</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/mchung">mchung</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <p>This is a Heroku buildpack for <a href="http://wordpress.org">Wordpress</a>.</p>

<p>It uses this <a href="http://github.com/mchung/wordpress-on-heroku">Wordpress</a> project template to bootstrap a highly tuned Wordpress site built on the following stack:</p>

<ul>
<li>
<code>nginx-1.3.11</code> - Nginx for serving web content.  Built specifically for Heroku.  <a href="https://github.com/mchung/heroku-buildpack-wordpress/blob/master/support/package_nginx">See compile options</a>.</li>
<li>
<code>php-5.4.11</code> - PHP-FPM for process management and APC for caching opcodes.  <a href="https://github.com/mchung/heroku-buildpack-wordpress/blob/master/support/package_php">See compile options</a>.</li>
<li>
<code>wordpress-3.5.1</code> - Downloaded directly <a href="http://wordpress.org/download/release-archive/">from wordpress.org</a>.</li>
<li>
<code>MySQL</code> - ClearDB for the MySQL backend.</li>
<li>
<code>Sendgrid</code> - Sendgrid for the email backend.</li>
<li>
<code>MemCachier</code> - MemCachier for the memcached backend.</li>
</ul><h2>Getting started in 60 seconds</h2>

<p>Fork this <a href="http://github.com/mchung/wordpress-on-heroku">Wordpress project template</a>.</p>

<p>Clone the repository</p>

<div class="highlight"><pre><span class="nv">$ </span>git clone git://github.com/username/wordpress-on-heroku.git myblog
</pre></div>

<p>Create the app on Heroku.</p>

<div class="highlight"><pre><span class="nv">$ </span><span class="nb">cd </span>myblog
<span class="nv">$ </span>heroku create -s cedar
<span class="nv">$ </span>heroku config:add <span class="nv">BUILDPACK_URL</span><span class="o">=</span>https://github.com/mchung/heroku-buildpack-wordpress.git
</pre></div>

<blockquote>
<p>Don't have the Heroku Toolbelt installed? Follow these <a href="https://devcenter.heroku.com/articles/quickstart">quickstart instructions</a>. Takes about 2 minutes.</p>
</blockquote>

<p>Deploy your Wordpress site to Heroku</p>

<div class="highlight"><pre><span class="nv">$ </span>git push heroku master
...
-----&gt; Heroku receiving push
-----&gt; Fetching custom git buildpack... <span class="k">done</span>
-----&gt; Wordpress app detected
.
<span class="o">[</span>...<span class="o">]</span>
.
-----&gt; Discovering process types
       Procfile declares types     -&gt; <span class="o">(</span>none<span class="o">)</span>
       Default types <span class="k">for </span>Wordpress -&gt; web
-----&gt; Compiled slug size: 33.7MB
-----&gt; Launching... <span class="k">done</span>, v7
</pre></div>

<p>Open your new Wordpress site in a web browser</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku apps:open
</pre></div>

<blockquote>
<p>Don't forget to <a href="https://github.com/mchung/heroku-buildpack-wordpress/wiki/Sites-running-Wordpress-on-Heroku">add your site to the wiki</a></p>
</blockquote>

<h2>Overview</h2>

<p>The buildpack bootstraps a Wordpress site using the <a href="http://github.com/mchung/wordpress-on-heroku">mchung/wordpress-on-heroku</a> project template.  That repo contains everything required to configure Wordpress on Heroku.</p>

<p>Enabling and configuring the following Wordpress plugins will also speed things up significantly.</p>

<ul>
<li>
<code>heroku-sendgrid</code> - Instructs phpmailer to send SMTP email with Sendgrid.

<ul>
<li>EMAIL_REPLY_TO=<a href="mailto:alfred@example.com">alfred@example.com</a>
</li>
<li>EMAIL_FROM=<a href="mailto:batman@example.com">batman@example.com</a>
</li>
<li>EMAIL_NAME=Bruce Wayne</li>
</ul>
</li>
<li>
<code>heroku-google-analytics</code> - Adds Google Analytics to your site.

<ul>
<li>GOOG_UA_ID=UA-9999999</li>
</ul>
</li>
<li>
<code>wpro</code> - Instructs Wordpress to upload everything to S3.</li>
<li>
<code>batcache</code> - Instructs Wordpress to use memcached for caching.</li>
<li>
<code>memcachier</code> - Depend on a modern memcached plugin.</li>
<li>
<code>cloudflare</code> - OPTIONAL, but awesome.  If Cloudflare is installed, the plugin instructs Wordpress to play nicely with CloudFlare.  It sets the correct IP addresses from visitors and comments, and also protects Wordpress from spammers.  Keep in mind that the free version doesn't support SSL.</li>
</ul><blockquote>
<p>To set a config variable: <code>heroku config:set GOOG_UA_ID=UA=1234777-9</code></p>
</blockquote>

<p>There are also several config files for configuring Wordpress on Heroku.</p>

<ul>
<li>
<code>wp-content</code> - Wordpress themes and plugins</li>
<li>
<code>wp-config.php</code> - Wordpress configuration</li>
<li>
<code>nginx.conf.erb</code> - Nginx configuration</li>
<li>
<code>php-fpm.conf</code> - PHP-FPM configuration</li>
<li>
<code>php.ini</code> - PHP configuration</li>
</ul><p>Feel free to hack on these files.  For example, to remove the PHP-FPM status page at <code>/status.html</code>, delete the directive from <code>nginx.conf.erb</code>.  Themes and plugins can be added and deployed to the <code>setup/wp-content</code> directory.</p>

<h2>Usage</h2>

<h3>Adding a custom domain name</h3>

<div class="highlight"><pre><span class="nv">$ </span>heroku domains:add marcchung.org
<span class="nv">$ </span>heroku domains:add www.marcchung.org
</pre></div>

<p>Note: Adding a domain still requires some DNS setup work. Basically you'll want to do something like this:</p>

<div class="highlight"><pre>ALIAS marcchung.org -&gt; proxy.herokuapp.com
CNAME www.marcchung.org -&gt; proxy.herokuapp.com
</pre></div>

<blockquote>
<p><a href="https://dnsimple.com/r/d2bc9a934910c1">I use DNSimple and you should too</a>.</p>
</blockquote>

<h3>Adding a theme</h3>

<div class="highlight"><pre><span class="nv">$ </span>cp -r appply setup/wp-content/themes/
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"New theme"</span>
<span class="nv">$ </span>git push heroku master
</pre></div>

<h3>Adding a plugin</h3>

<div class="highlight"><pre><span class="nv">$ </span>cp -r google-analytics setup/wp-content/plugins/
<span class="nv">$ </span>git add .
<span class="nv">$ </span>git commit -m <span class="s2">"New plugin"</span>
<span class="nv">$ </span>git push heroku master
</pre></div>

<blockquote>
<p>Don't forget to activate it under the Plugins panel.</p>
</blockquote>

<h3>Configuring cron</h3>

<p>By default, wp-cron is fired on every page load and scheduled to run jobs like future posts or backups.  This buildpack disables wp-cron so that visitors don't have to wait to see the site.</p>

<p>Heroku allows you to trigger wp-cron from their scheduler</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku addons:add scheduler:standard

<span class="c"># Visit the Heroku scheduler dashboard and add a new task:</span>
./cron.sh
</pre></div>

<p>Alternatively, you may also re-enable wp-cron</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku config:set <span class="nv">DISABLE_WP_CRON</span><span class="o">=</span><span class="nb">false</span>
</pre></div>

<h3>Enable system access</h3>

<p>The alternative PHP cache and a generic PHPINFO page is available at /apc.php and /phpinfo.php.</p>

<div class="highlight"><pre><span class="nv">$ </span>heroku config:set <span class="nv">ENABLE_SYSTEM_DEBUG</span><span class="o">=</span><span class="nb">true</span>
<span class="nv">$ </span>heroku config:set <span class="nv">SYSTEM_USERNAME</span><span class="o">=</span>admin
<span class="nv">$ </span>heroku config:set <span class="nv">SYSTEM_PASSWORD</span><span class="o">=</span>secret123
<span class="c"># Visit /apc.php or /phpinfo.php</span>
</pre></div>

<h3>Workflow (optional)</h3>

<p>By keeping your changes separate, it'll be easier to pull in changes from the Wordpress site template.</p>

<p>Assign a remote <code>upstream</code></p>

<div class="highlight"><pre><span class="nv">$ </span>git remote add upstream https://github.com/mchung/wordpress-on-heroku.git
</pre></div>

<p>Track changes in a separate branch called <code>production</code>.</p>

<div class="highlight"><pre><span class="nv">$ </span>git checkout -B production
<span class="nv">$ </span>git push heroku production:master
<span class="c"># This keeps upstream changes separate from blog changes.</span>
</pre></div>

<p>Pull changes from upstream into <code>master</code></p>

<div class="highlight"><pre><span class="nv">$ </span>git co master
<span class="nv">$ </span>git pull
<span class="nv">$ </span>git co production
<span class="nv">$ </span>git merge master
</pre></div>

<p>Pull changes from upstream into <code>production</code></p>

<div class="highlight"><pre><span class="nv">$ </span>git pull --rebase upstream master
</pre></div>

<h2>How fast is this?</h2>

<p>Fast enough. Here are some benchmarks.</p>

<h3>Google PageSpeed</h3>

<p>Results from PageSpeed Insights: 94/100</p>

<p><a href="https://developers.google.com/speed/pagespeed/insights#url=wordpress-on-heroku.herokuapp.com&amp;mobile=false">See the PageSpeed report</a></p>

<h3>blitz.io</h3>

<p>Results from a blitz.io rush on a single Heroku dyno:</p>

<p><img src="https://s3.amazonaws.com/heroku-buildpack-wordpress/woh-blitz-details.png" alt="Blitz.io rush"></p>

<p><a href="https://www.blitz.io/report/541eb908b4ef3eec8d9c2ce2293a85ca">See the Blitz.io report</a></p>

<h3>Web Page Performance Test</h3>

<p><img src="https://s3.amazonaws.com/heroku-buildpack-wordpress/woh-webpagetest-details.png" alt="Results from WebPageTest"></p>

<p><a href="http://www.webpagetest.org/result/130201_BB_624/">See the WebPageTest report</a></p>

<h2>But doesn't Heroku only run Ruby applications?</h2>

<p>Not anymore. Heroku's latest offerings (See <a href="http://devcenter.heroku.com/articles/cedar">Celadon Cedar stack</a>) makes it easy (well, easyish) for developers to install and run any language, or service.</p>

<h2>Constraints with Heroku</h2>

<p>The <a href="http://devcenter.heroku.com/articles/dyno-isolation">ephemeral filesystem</a></p>

<ul>
<li>End-users cannot upload media assets to Heroku. WORKAROUND: Enable <code>wpro</code> and use that plugin to upload media assets to S3 instead.</li>
<li>End-users cannot update themes or plugins from the admin page. WORKAROUND: Add them to <code>setup/wp-content/themes</code> or <code>setup/wp-content/plugins</code> then push to Heroku.</li>
</ul><h2>Security disclosure</h2>

<p>Each time Wordpress is deployed, Heroku will fetch the latest buildpack from GitHub and execute the instructions in <code>compile</code> and <code>deploy</code>.  This buildpack will download the latest precompiled versions of Nginx, PHP, and Wordpress from my personal <a href="http://heroku-buildpack-wordpress.s3.amazonaws.com">S3 bucket</a> then add in config files from the <a href="https://github.com/mchung/wordpress-on-heroku/tree/master/setup"><code>setup</code></a> directory.</p>

<h2>Hacking and Contributing</h2>

<p>Not comfortable downloading and running a copy of someone else's PHP or Nginx executables? Not a problem!  The <code>support</code> directory also contains a handful of compilation and deployment scripts to automate several processes, which are currently used for maintenance and repo management.</p>

<ul>
<li>
<code>package_nginx</code> - Used to compile and upload the latest version of Nginx to S3.</li>
<li>
<code>package_php</code> - Used to compile and upload the latest version of PHP to S3.</li>
<li>
<code>wordup</code> - Really useful helper script for creating and destroying Wordpress sites.</li>
</ul><h2>TODO</h2>

<ul>
<li>Automate vendor upgrades. Make it easy to keep in sync with latest Nginx, PHP, and Wordpress.</li>
<li>End-users shouldn't be able to do things that aren't supported on Heroku.</li>
<li>Integrate New Relic.</li>
</ul><h2>Authors and Contributors</h2>

<ul>
<li>Marc Chung - <a href="https://github.com/mchung">@mchung</a> on GitHub and <a href="https://twitter.com/heisenthought">@heisenthought</a> on Twitter</li>
</ul><h2>Thanks</h2>

<p>Thanks for reading this all the way through. If you find this useful, please add an entry to the <a href="https://github.com/mchung/heroku-buildpack-wordpress/wiki/Sites-running-Wordpress-on-Heroku">list of Wordpress sites running on Heroku</a>.</p>

<h2>License</h2>

<p>The MIT License - Copyright (c) 2013 Marc Chung</p>

<p></p>

<div>
<div>
<div>
take my code with you
</div>

<div>
and do whatever you want
</div>

<div>
but please don't blame me
</div>

<div>
—
Aaron Swartz
</div>

<p></p>
</div>

<div>
<a href="http://haikuist.com/haiku/1922">This Haiku</a>
brought to you by
<a href="http://haikuist.com/">Haikuist</a>
</div>

<p></p>
</div>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-31205985-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>